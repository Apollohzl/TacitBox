'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';

const LoginPage = () => {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleWechatLogin = async () => {
    setLoading(true);
    setError(null);

    try {
      // Step 1: 获取跳转登录地址
      const response = await fetch(
        `https://u.daib.cn/connect.php?act=login&appid=2423&appkey=5182677ea009b870808053105a2ded54&type=wx&redirect_uri=${encodeURIComponent(window.location.origin + '/login/process')}`
      );

      const data = await response.json();

      if (data.code === 0) {
        // Step 2: 跳转到登录地址
        window.location.href = data.url;
      } else {
        setError(data.msg || '获取登录地址失败');
      }
    } catch (err) {
      console.error('登录请求失败:', err);
      setError('网络错误，请稍后重试');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-400 to-cyan-500 p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">默契盒子</h1>
          <p className="text-gray-600">登录以开始体验</p>
        </div>

        <div className="space-y-4">
          <button
            onClick={handleWechatLogin}
            disabled={loading}
            className={`w-full flex items-center justify-center py-4 px-6 rounded-xl text-white font-bold text-lg transition-all ${
              loading 
                ? 'bg-gray-400 cursor-not-allowed' 
                : 'bg-green-500 hover:bg-green-600 active:bg-green-700'
            }`}
          >
            {loading ? (
              <span className="flex items-center">
                <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                跳转中...
              </span>
            ) : (
              <span className="flex items-center">
                <svg className="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="none">
                  <path d="M19.5 12C19.5 15.59 16.59 18.5 13 18.5C12.23 18.5 11.51 18.33 10.86 18.04L8 20V17.43C6.7 16.69 5.64 15.43 5.15 14H5C3.34 14 2 12.66 2 11C2 9.34 3.34 8 5 8C6.66 8 8 9.34 8 11C8 11.37 7.92 11.72 7.79 12.05C8.26 12.2 8.7 12.46 9.07 12.79C9.25 12.29 9.59 11.87 10.02 11.59C9.96 11.5 9.93 11.39 9.93 11.27C9.93 10.4 10.66 9.7 11.5 9.7C12.02 9.7 12.45 10.06 12.57 10.56C13.1 10.44 13.66 10.4 14.21 10.4C15.07 10.4 15.91 10.56 16.68 10.87C17.13 10.4 17.56 9.9 17.97 9.37C17.53 9.17 17.06 9.05 16.57 9.05C15.7 9.05 14.97 9.71 14.89 10.57C14.38 10.51 13.86 10.48 13.34 10.48C12.48 10.48 11.65 10.68 10.91 11.06C11.37 11.53 11.7 12.12 11.85 12.77C12.7 12.62 13.58 12.53 14.48 12.53C16.07 12.53 17.52 13.13 18.61 14.12C19.7 15.1 20.3 16.46 20.3 17.9C20.3 19.34 19.7 20.7 18.61 21.68C17.52 22.67 16.07 23.27 14.48 23.27C12.43 23.27 10.64 22.34 9.47 20.88L7.8 22.13C9.38 24.04 11.8 25 14.48 25C17.16 25 19.58 24.04 21.16 22.13C22.74 20.22 23.5 17.61 23.5 15C23.5 12.39 22.74 9.78 21.16 7.87C19.58 5.96 17.16 5 14.48 5C11.8 5 9.38 5.96 7.8 7.87C6.22 9.78 5.46 12.39 5.46 15C5.46 17.61 6.22 20.22 7.8 22.13L9.47 20.88C10.13 21.72 11.04 22.36 12.08 22.71C11.43 22.28 10.93 21.65 10.65 20.91C10.37 20.17 10.33 19.36 10.54 18.58C10.75 17.8 11.19 17.1 11.8 16.57C11.27 16.51 10.73 16.58 10.24 16.78C9.75 16.98 9.32 17.3 9.01 17.7C8.7 18.1 8.52 18.57 8.49 19.05C8.46 19.53 8.58 20.01 8.84 20.42C9.1 20.83 9.48 21.15 9.92 21.34C10.36 21.53 10.85 21.58 11.32 21.48C11.79 21.38 12.21 21.14 12.52 20.79C12.83 20.44 13.01 20 13.03 19.53C13.05 19.06 12.91 18.59 12.63 18.21C12.35 17.83 11.95 17.57 11.5 17.47C11.05 17.37 10.57 17.43 10.16 17.64C9.75 17.85 9.43 18.2 9.26 18.62C9.09 19.04 9.09 19.5 9.25 19.92C9.41 20.34 9.72 20.68 10.11 20.89C10.5 21.1 10.95 21.16 11.38 21.06C11.81 20.96 12.18 20.71 12.43 20.35C12.68 19.99 12.79 19.55 12.74 19.1C12.69 18.65 12.48 18.24 12.15 17.94C11.82 17.64 11.39 17.47 10.93 17.46C10.47 17.45 10.03 17.6 9.69 17.88C9.35 18.16 9.14 18.55 9.09 18.97C9.04 19.39 9.16 19.81 9.43 20.14C9.7 20.47 10.09 20.68 10.52 20.72C10.95 20.76 11.36 20.62 11.66 20.34C11.96 20.06 12.12 19.66 12.1 19.25C12.08 18.84 11.89 18.46 11.57 18.2C11.25 17.94 10.83 17.82 10.42 17.87C10.01 17.92 9.64 18.13 9.39 18.45C9.14 18.77 9.03 19.17 9.09 19.57C9.15 19.97 9.37 20.32 9.69 20.55C9.35 20.41 9.06 20.16 8.86 19.84C8.66 19.52 8.56 19.15 8.58 18.78C8.6 18.41 8.74 18.06 8.97 17.78C9.2 17.5 9.51 17.3 9.86 17.21C10.21 17.12 10.57 17.14 10.9 17.27C11.23 17.4 11.51 17.63 11.7 17.93C11.89 18.23 11.98 18.58 11.95 18.94C11.92 19.3 11.78 19.64 11.55 19.91C11.32 20.18 11.01 20.36 10.67 20.43C10.33 20.5 9.98 20.45 9.67 20.29C9.36 20.13 9.11 19.87 8.96 19.55C8.81 19.23 8.77 18.87 8.85 18.52C8.93 18.17 9.12 17.86 9.39 17.63C9.66 17.4 10 17.26 10.36 17.23C10.72 17.2 11.07 17.29 11.36 17.48C11.65 17.67 11.87 17.95 11.98 18.27C12.09 18.59 12.09 18.93 11.98 19.25C11.87 19.57 11.65 19.85 11.36 20.04C11.07 20.23 10.72 20.32 10.36 20.29C10 20.26 9.67 20.12 9.41 19.89C9.15 19.66 8.98 19.35 8.92 19.01C8.86 18.67 8.92 18.32 9.08 18.01C9.24 17.7 9.5 17.45 9.82 17.3C10.14 17.15 10.51 17.11 10.87 17.19C11.23 17.27 11.55 17.46 11.79 17.73C12.03 18 12.17 18.34 12.19 18.69C12.21 19.04 12.11 19.38 11.9 19.67C11.69 19.96 11.39 20.17 11.05 20.27C10.71 20.37 10.34 20.35 10.02 20.22C9.7 20.09 9.44 19.86 9.28 19.57C9.12 19.28 9.07 18.95 9.14 18.63C9.21 18.31 9.39 18.03 9.65 17.84C9.91 17.65 10.23 17.56 10.57 17.58C10.91 17.6 11.22 17.73 11.47 17.94C11.72 18.15 11.9 18.44 11.99 18.75C12.08 19.06 12.07 19.39 11.96 19.69C11.85 19.99 11.65 20.24 11.39 20.4C11.13 20.56 10.83 20.62 10.53 20.57C10.23 20.52 9.95 20.37 9.74 20.14C9.53 19.91 9.4 19.61 9.38 19.29C9.36 18.97 9.45 18.65 9.64 18.39C9.83 18.13 10.11 17.94 10.43 17.85C10.75 17.76 11.09 17.78 11.39 17.9C11.69 18.02 11.94 18.24 11.1 18.4"
                    fill="currentColor"
                  />
                </svg>
                微信登录
              </span>
            )}
          </button>
        </div>

        {error && (
          <div className="mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-center">
            {error}
          </div>
        )}

        <div className="mt-6 text-center text-sm text-gray-600">
          <p>登录即表示您同意我们的服务条款和隐私政策</p>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;